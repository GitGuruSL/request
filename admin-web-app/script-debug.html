<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script Debug Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <div class="card">
            <div class="card-header">
                <h3>üîç JavaScript Execution Debug</h3>
            </div>
            <div class="card-body">
                <div id="results" class="mb-4"></div>
                
                <h5>Script Execution Test:</h5>
                <button class="btn btn-primary mb-2" onclick="testScriptExecution()">Test Script Execution</button>
                
                <hr>
                <div>
                    <button class="btn btn-warning" onclick="checkAdminPanelErrors()">
                        üîç Check Admin Panel Console Errors
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const alertClass = type === 'error' ? 'alert-danger' : 
                              type === 'success' ? 'alert-success' : 
                              type === 'warning' ? 'alert-warning' : 'alert-info';
            
            results.innerHTML += `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    <small>${new Date().toLocaleTimeString()}</small>: ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        }
        
        function testScriptExecution() {
            results.innerHTML = '';
            log('üîç Testing script execution order...', 'info');
            
            // Test 1: Check if we can create a simple function
            try {
                window.testFunction = function() {
                    return 'test successful';
                };
                if (typeof window.testFunction === 'function' && window.testFunction() === 'test successful') {
                    log('‚úÖ Basic function creation works', 'success');
                } else {
                    log('‚ùå Basic function creation failed', 'error');
                }
            } catch (e) {
                log('‚ùå Error creating basic function: ' + e.message, 'error');
            }
            
            // Test 2: Try to inject a function similar to showSection
            try {
                window.mockShowSection = function(sectionName) {
                    return `Switching to section: ${sectionName}`;
                };
                
                if (typeof window.mockShowSection === 'function') {
                    const result = window.mockShowSection('test');
                    log('‚úÖ Mock showSection created successfully: ' + result, 'success');
                } else {
                    log('‚ùå Mock showSection creation failed', 'error');
                }
            } catch (e) {
                log('‚ùå Error creating mock showSection: ' + e.message, 'error');
            }
            
            // Test 3: Open admin panel and check for immediate JavaScript errors
            setTimeout(() => {
                checkAdminPanelErrors();
            }, 1000);
        }
        
        function checkAdminPanelErrors() {
            log('üîç Opening admin panel to check for JavaScript errors...', 'info');
            
            const adminWindow = window.open('complete-admin.html', 'admin-debug-test');
            
            // Check after different time intervals
            const checkIntervals = [1000, 3000, 5000];
            
            checkIntervals.forEach((interval, index) => {
                setTimeout(() => {
                    if (adminWindow && !adminWindow.closed) {
                        try {
                            // Check if the window has basic properties
                            if (adminWindow.document) {
                                log(`‚úÖ [${interval}ms] Admin window accessible`, 'success');
                                
                                // Check if Firebase loaded
                                if (adminWindow.db || adminWindow.firebase) {
                                    log(`‚úÖ [${interval}ms] Firebase detected in admin window`, 'success');
                                } else {
                                    log(`‚ö†Ô∏è [${interval}ms] Firebase not detected`, 'warning');
                                }
                                
                                // Check for our functions
                                const functions = ['showSection', 'approveDocument', 'rejectDocument', 'viewDriver'];
                                functions.forEach(funcName => {
                                    if (typeof adminWindow[funcName] === 'function' || typeof adminWindow.window?.[funcName] === 'function') {
                                        log(`‚úÖ [${interval}ms] ${funcName} found!`, 'success');
                                    } else {
                                        log(`‚ùå [${interval}ms] ${funcName} missing`, 'error');
                                    }
                                });
                                
                                // Check global variables that should be defined
                                const globalVars = ['users', 'drivers', 'businesses', 'currentSection'];
                                globalVars.forEach(varName => {
                                    if (adminWindow[varName] !== undefined || adminWindow.window?.[varName] !== undefined) {
                                        log(`‚úÖ [${interval}ms] Global variable ${varName} found`, 'success');
                                    } else {
                                        log(`‚ùå [${interval}ms] Global variable ${varName} missing`, 'error');
                                    }
                                });
                                
                            } else {
                                log(`‚ùå [${interval}ms] Cannot access admin window document`, 'error');
                            }
                        } catch (e) {
                            log(`‚ùå [${interval}ms] Error accessing admin window: ${e.message}`, 'error');
                        }
                        
                        // Close window after last check
                        if (index === checkIntervals.length - 1) {
                            setTimeout(() => {
                                if (adminWindow && !adminWindow.closed) {
                                    adminWindow.close();
                                    log('üîí Admin window closed', 'info');
                                }
                            }, 1000);
                        }
                    } else {
                        log(`‚ùå [${interval}ms] Admin window not accessible or closed`, 'error');
                    }
                }, interval);
            });
        }
        
        // Auto-run basic test when page loads
        window.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Script debug page loaded - Click "Test Script Execution" to run tests', 'info');
        });
    </script>
</body>
</html>
