<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        #console { background: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 5px; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>🔍 Firebase Authentication Debug</h1>
    
    <div>
        <button onclick="testPopup()">Test Popup Sign-In</button>
        <button onclick="testRedirect()">Test Redirect Sign-In</button>
        <button onclick="clearConsole()">Clear Console</button>
    </div>
    
    <div id="userInfo" style="margin: 20px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
        <strong>User Status:</strong> <span id="authStatus">Checking...</span>
    </div>
    
    <div id="console"></div>

    <script type="module">
        // Import Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithPopup, signInWithRedirect, getRedirectResult, GoogleAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCtuD42SzwxKmSY5p-x5olFex2U_S9YrMk",
            authDomain: "request-marketplace.firebaseapp.com",
            projectId: "request-marketplace",
            storageBucket: "request-marketplace.firebasestorage.app",
            messagingSenderId: "355474518888",
            appId: "1:355474518888:web:7b3a7f6f7d7a8b0d8e8f9f"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        let currentUser = null;

        // Console logging
        function log(message, type = 'info') {
            const consoleDiv = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            consoleDiv.appendChild(logEntry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(message);
        }

        // Check for redirect result on page load
        getRedirectResult(auth)
            .then((result) => {
                if (result) {
                    log(`✅ Redirect sign-in successful: ${result.user.email}`, 'success');
                } else {
                    log('ℹ️ No redirect result', 'info');
                }
            })
            .catch((error) => {
                log(`❌ Redirect error: ${error.code} - ${error.message}`, 'error');
            });

        // Auth state listener
        onAuthStateChanged(auth, (user) => {
            const statusElement = document.getElementById('authStatus');
            if (user) {
                currentUser = user;
                statusElement.innerHTML = `<span class="success">✅ Signed in as: ${user.email}</span>`;
                log(`✅ Auth state: User signed in as ${user.email}`, 'success');
            } else {
                currentUser = null;
                statusElement.innerHTML = `<span class="error">❌ Not signed in</span>`;
                log('❌ Auth state: User not signed in', 'info');
            }
        });

        // Test functions
        window.testPopup = async () => {
            log('🔄 Testing popup sign-in...', 'info');
            try {
                const result = await signInWithPopup(auth, googleProvider);
                log(`✅ Popup sign-in successful: ${result.user.email}`, 'success');
            } catch (error) {
                log(`❌ Popup sign-in failed: ${error.code} - ${error.message}`, 'error');
            }
        };

        window.testRedirect = async () => {
            log('🔄 Testing redirect sign-in...', 'info');
            try {
                await signInWithRedirect(auth, googleProvider);
                log('🔄 Redirect initiated...', 'info');
            } catch (error) {
                log(`❌ Redirect sign-in failed: ${error.code} - ${error.message}`, 'error');
            }
        };

        window.clearConsole = () => {
            document.getElementById('console').innerHTML = '';
        };

        log('🔥 Firebase Auth Debug initialized', 'success');
        log(`📍 Current URL: ${window.location.href}`, 'info');
    </script>
</body>
</html>
