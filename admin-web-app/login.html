<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - Request Marketplace</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --dark-color: #1f2937;
            --light-color: #f8fafc;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .logo {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .login-title {
            color: var(--dark-color);
            margin-bottom: 30px;
            font-weight: 600;
        }

        .google-btn {
            background: #4285f4;
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 20px;
        }

        .google-btn:hover {
            background: #357ae8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
        }

        .google-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .divider {
            margin: 30px 0;
            position: relative;
            text-align: center;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e5e7eb;
        }

        .divider span {
            background: white;
            padding: 0 20px;
            color: #6b7280;
            font-size: 14px;
        }

        .admin-note {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
            color: #92400e;
        }

        .loading {
            display: none;
        }

        .loading.show {
            display: inline-block;
        }

        .error-message {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            color: #dc2626;
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .success-message {
            background: #dcfce7;
            border: 1px solid #86efac;
            color: #166534;
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo">
            <i class="fas fa-store"></i>
        </div>
        <h2 class="login-title">Admin Panel Login</h2>
        <p class="text-muted mb-4">Sign in to access the admin dashboard</p>

        <button type="button" class="btn google-btn" id="googleSignInBtn">
            <i class="fab fa-google me-2"></i>
            <span id="btnText">Continue with Google</span>
            <span class="loading spinner-border spinner-border-sm ms-2" role="status"></span>
        </button>

        <div class="divider">
            <span>Secure Authentication</span>
        </div>

        <div class="admin-note">
            <i class="fas fa-shield-alt me-2"></i>
            <strong>Admin Access Only</strong><br>
            Only authorized administrators can access this panel. Your account will be verified automatically.
        </div>

        <div class="error-message" id="errorMessage">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span id="errorText"></span>
        </div>

        <div class="success-message" id="successMessage">
            <i class="fas fa-check-circle me-2"></i>
            <span id="successText"></span>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCtuD42SzwxKmSY5p-x5olFex2U_S9YrMk",
            authDomain: "request-marketplace.firebaseapp.com",
            projectId: "request-marketplace",
            storageBucket: "request-marketplace.firebasestorage.app",
            messagingSenderId: "355474518888",
            appId: "1:355474518888:web:abc123def456ghi789"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        console.log('ðŸ”¥ Firebase initialized for admin login');

        // Admin configuration - Add authorized admin emails here
        const AUTHORIZED_ADMINS = [
            'admin@requestmarketplace.com',
            'gitgurusl@gmail.com',
            'cyberexpert@alphabet.com',
            // Add more authorized admin emails here
        ];

        // Check if user is already logged in
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log('User signed in:', user.email);
                await verifyAndRedirect(user);
            }
        });

        // Google Sign-In function
        async function signInWithGoogle() {
            const provider = new GoogleAuthProvider();
            provider.addScope('email');
            provider.addScope('profile');

            try {
                showLoading(true);
                hideMessages();

                const result = await signInWithPopup(auth, provider);
                const user = result.user;

                console.log('Google sign-in successful:', user.email);
                await verifyAndRedirect(user);

            } catch (error) {
                console.error('Google sign-in error:', error);
                showError('Sign-in failed: ' + error.message);
                showLoading(false);
            }
        }

        // Verify admin status and redirect
        async function verifyAndRedirect(user) {
            try {
                const email = user.email.toLowerCase();
                
                // Check if user is in authorized admins list
                if (!AUTHORIZED_ADMINS.includes(email)) {
                    showError('Access denied. You are not authorized to access the admin panel.');
                    await signOut(auth);
                    showLoading(false);
                    return;
                }

                // Create/update admin record in Firestore
                const adminRef = doc(db, 'admins', user.uid);
                await setDoc(adminRef, {
                    email: user.email,
                    displayName: user.displayName,
                    photoURL: user.photoURL,
                    role: 'admin',
                    lastLogin: new Date(),
                    createdAt: new Date()
                }, { merge: true });

                // Store admin session in localStorage
                localStorage.setItem('adminUser', JSON.stringify({
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName,
                    photoURL: user.photoURL,
                    role: 'admin'
                }));

                showSuccess('Authentication successful! Redirecting...');
                
                // Redirect to admin dashboard
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);

            } catch (error) {
                console.error('Admin verification error:', error);
                showError('Verification failed: ' + error.message);
                showLoading(false);
            }
        }

        // UI Helper functions
        function showLoading(show) {
            const btn = document.getElementById('googleSignInBtn');
            const loading = btn.querySelector('.loading');
            const text = document.getElementById('btnText');
            
            if (show) {
                btn.disabled = true;
                loading.classList.add('show');
                text.textContent = 'Signing in...';
            } else {
                btn.disabled = false;
                loading.classList.remove('show');
                text.textContent = 'Continue with Google';
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorDiv.style.display = 'block';
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            const successText = document.getElementById('successText');
            successText.textContent = message;
            successDiv.style.display = 'block';
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        // Event listeners
        document.getElementById('googleSignInBtn').addEventListener('click', signInWithGoogle);

        // Check if already authenticated on page load
        window.addEventListener('load', () => {
            const adminUser = localStorage.getItem('adminUser');
            if (adminUser) {
                const user = JSON.parse(adminUser);
                showSuccess(`Welcome back, ${user.displayName}! Redirecting...`);
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            }
        });
    </script>
</body>
</html>
