<!DOCTYPE html>
<html>
<head>
    <title>Check Categories Status</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Checking Product Categories Status...</h1>
    <div id="output"></div>

    <script>
        // Firebase config (same as your project)
        const firebaseConfig = {
            apiKey: "AIzaSyC5hb6Ydkp__EZgX-kRjJgtOKZKg8TNkJg",
            authDomain: "request-marketplace-45a59.firebaseapp.com",
            projectId: "request-marketplace-45a59",
            storageBucket: "request-marketplace-45a59.firebasestorage.app",
            messagingSenderId: "635550436472",
            appId: "1:635550436472:web:72ee20ad95cdcf65c1c86a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function checkCategories() {
            try {
                console.log('üîç Checking product categories...');
                
                const snapshot = await db.collection('product_categories').get();
                
                if (snapshot.empty) {
                    document.getElementById('output').innerHTML = `
                        <h2 style="color: red;">‚ùå NO CATEGORIES FOUND!</h2>
                        <p>The product_categories collection is empty.</p>
                        <p><strong>Solution:</strong> Run the fix-add-product.js script or use the admin panel to create categories.</p>
                    `;
                    return;
                }

                let html = '<h2>üìã Product Categories Status:</h2><ul>';
                let activeCount = 0;
                let inactiveCount = 0;

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const isActive = data.isActive === true;
                    
                    if (isActive) {
                        activeCount++;
                    } else {
                        inactiveCount++;
                    }

                    html += `
                        <li style="margin: 10px 0;">
                            <strong>${data.name}</strong> (ID: ${doc.id})
                            <br>Status: <span style="color: ${isActive ? 'green' : 'red'}; font-weight: bold;">
                                ${isActive ? '‚úÖ ACTIVE' : '‚ùå INACTIVE'}
                            </span>
                            <br>Description: ${data.description || 'No description'}
                        </li>
                    `;
                });

                html += '</ul>';
                html += `
                    <h3>Summary:</h3>
                    <p>üìä <strong>Active Categories:</strong> ${activeCount}</p>
                    <p>üìä <strong>Inactive Categories:</strong> ${inactiveCount}</p>
                `;

                if (activeCount === 0) {
                    html += `
                        <div style="background: #ffebee; border: 1px solid #f44336; padding: 15px; margin: 10px 0; border-radius: 5px;">
                            <h3 style="color: #d32f2f;">üö® PROBLEM IDENTIFIED!</h3>
                            <p>Your Flutter app can't load categories because <strong>all categories are INACTIVE</strong>.</p>
                            <p>The Flutter app only loads categories where <code>isActive: true</code>.</p>
                            <p><strong>Solution:</strong> Go to your admin panel and click "Activate All Categories" button.</p>
                        </div>
                    `;
                } else {
                    html += `
                        <div style="background: #e8f5e8; border: 1px solid #4caf50; padding: 15px; margin: 10px 0; border-radius: 5px;">
                            <h3 style="color: #2e7d32;">‚úÖ Categories are working!</h3>
                            <p>You have ${activeCount} active categories. Your Flutter app should work fine.</p>
                            <p>If it's still not working, the issue might be elsewhere.</p>
                        </div>
                    `;
                }

                document.getElementById('output').innerHTML = html;

            } catch (error) {
                document.getElementById('output').innerHTML = `
                    <h2 style="color: red;">‚ùå Error checking categories</h2>
                    <p>${error.message}</p>
                `;
                console.error('Error:', error);
            }
        }

        // Run check when page loads
        window.addEventListener('load', checkCategories);
    </script>
</body>
</html>
