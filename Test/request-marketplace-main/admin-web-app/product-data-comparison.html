<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Data Comparison</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .product-section {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
        }
        .error {
            background-color: #ffe6e6;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background-color: #e6ffe6;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .data-row {
            margin: 5px 0;
            padding: 5px;
            background-color: #f9f9f9;
        }
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Product Data Comparison Debug</h1>
    <button onclick="analyzeProducts()">Analyze All Products</button>
    
    <div id="results"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getFirestore, collection, getDocs, doc, getDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAgTVL1zGdXkuE1Cb6Oc9uo99qkh6VKiJM",
            authDomain: "requestmarketplace-f6ac3.firebaseapp.com",
            projectId: "requestmarketplace-f6ac3",
            storageBucket: "requestmarketplace-f6ac3.firebasestorage.app",
            messagingSenderId: "690324344664",
            appId: "1:690324344664:web:7a57c6de7c37e4e5c9b02b",
            measurementId: "G-5KVCQHH8Y7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.analyzeProducts = async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Analyzing products...</p>';

            try {
                // Get all business products
                const businessProductsSnapshot = await getDocs(collection(db, 'business_products'));
                const businessProducts = businessProductsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                console.log('Business products:', businessProducts);

                // Get all master products
                const masterProductsSnapshot = await getDocs(collection(db, 'master_products'));
                const masterProducts = masterProductsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                console.log('Master products:', masterProducts);

                let html = `
                    <h2>Analysis Results</h2>
                    <p><strong>Found ${businessProducts.length} business products and ${masterProducts.length} master products</strong></p>
                `;

                // Analyze each business product
                for (const businessProduct of businessProducts) {
                    html += `
                        <div class="product-section">
                            <h3>Business Product: ${businessProduct.id}</h3>
                            <div class="data-row"><strong>Business ID:</strong> ${businessProduct.businessId}</div>
                            <div class="data-row"><strong>Master Product ID:</strong> ${businessProduct.masterProductId}</div>
                            <div class="data-row"><strong>Price:</strong> ${businessProduct.price}</div>
                            <div class="data-row"><strong>Status:</strong> ${businessProduct.status}</div>
                            <div class="data-row"><strong>Is Active:</strong> ${businessProduct.isActive}</div>
                            <div class="data-row"><strong>Created:</strong> ${businessProduct.createdAt ? new Date(businessProduct.createdAt.seconds * 1000).toLocaleString() : 'N/A'}</div>
                    `;

                    // Look for matching master product
                    const masterProduct = masterProducts.find(mp => mp.id === businessProduct.masterProductId);
                    
                    if (masterProduct) {
                        html += `
                            <div class="success">
                                <h4>✅ Master Product Found</h4>
                                <div class="data-row"><strong>Name:</strong> ${masterProduct.name}</div>
                                <div class="data-row"><strong>Brand:</strong> ${masterProduct.brand}</div>
                                <div class="data-row"><strong>Description:</strong> ${masterProduct.description}</div>
                                <div class="data-row"><strong>Category:</strong> ${masterProduct.category}</div>
                                <div class="data-row"><strong>Image URLs:</strong> ${JSON.stringify(masterProduct.imageUrls)}</div>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="error">
                                <h4>❌ Master Product NOT FOUND!</h4>
                                <p>Looking for master product ID: <strong>${businessProduct.masterProductId}</strong></p>
                                <p>This is why the product shows as "Unknown Product"</p>
                            </div>
                        `;
                    }

                    html += `
                            <h4>Complete Business Product Data:</h4>
                            <pre>${JSON.stringify(businessProduct, null, 2)}</pre>
                        </div>
                    `;
                }

                // Show all available master products
                html += `
                    <div class="product-section">
                        <h3>All Available Master Products</h3>
                `;
                
                for (const masterProduct of masterProducts) {
                    html += `
                        <div class="data-row">
                            <strong>ID:</strong> ${masterProduct.id} | 
                            <strong>Name:</strong> ${masterProduct.name} | 
                            <strong>Brand:</strong> ${masterProduct.brand}
                        </div>
                    `;
                }

                html += `
                        <h4>Complete Master Products Data:</h4>
                        <pre>${JSON.stringify(masterProducts, null, 2)}</pre>
                    </div>
                `;

                resultsDiv.innerHTML = html;

            } catch (error) {
                console.error('Error analyzing products:', error);
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
