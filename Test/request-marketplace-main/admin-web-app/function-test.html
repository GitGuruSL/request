<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Function Test</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Testing Admin Panel Functions</h1>
    
    <div id="test-results"></div>
    
    <button onclick="testFunctions()">Test Functions</button>
    <button onclick="loadCompleteAdmin()">Load Complete Admin</button>

    <script>
        // Initialize Firebase (you'll need your config)
        const firebaseConfig = {
            apiKey: "AIzaSyBNjDJkF10BAdMhWjkWyWn-V5c5Vfqo8P8",
            authDomain: "request-marketplace-firebase.firebaseapp.com",
            projectId: "request-marketplace-firebase",
            storageBucket: "request-marketplace-firebase.firebasestorage.app",
            messagingSenderId: "950006600677",
            appId: "1:950006600677:web:ae0b1e8a65e5bf6c8de32a"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        console.log('üî• Firebase initialized successfully!');

        // Define the functions directly here to test them
        window.showSection = function(sectionName) {
            console.log('‚úÖ showSection called with:', sectionName);
            return true;
        };

        window.approveDocument = async function(driverId, documentType, collectionName = 'drivers') {
            try {
                console.log(`üîß Approving ${documentType} for driver ${driverId}`);
                
                // Update Firestore
                const driverRef = db.collection(collectionName).doc(driverId);
                const updateData = {};
                updateData[`documentVerification.${documentType}.status`] = 'approved';
                updateData[`documentVerification.${documentType}.approvedAt`] = firebase.firestore.FieldValue.serverTimestamp();
                updateData[`documentVerification.${documentType}.rejectedAt`] = firebase.firestore.FieldValue.delete();
                updateData[`documentVerification.${documentType}.notes`] = '';

                await driverRef.update(updateData);
                
                console.log(`‚úÖ ${documentType} approved successfully for driver ${driverId}`);
                
                // Show success message
                alert(`‚úÖ ${documentType} approved successfully!`);
                
                return true;
            } catch (error) {
                console.error(`‚ùå Error approving ${documentType}:`, error);
                alert(`‚ùå Error approving ${documentType}: ${error.message}`);
                return false;
            }
        };

        window.rejectDocument = async function(driverId, documentType, collectionName = 'drivers') {
            try {
                console.log(`üîß Rejecting ${documentType} for driver ${driverId}`);
                
                // Update Firestore
                const driverRef = db.collection(collectionName).doc(driverId);
                const updateData = {};
                updateData[`documentVerification.${documentType}.status`] = 'rejected';
                updateData[`documentVerification.${documentType}.rejectedAt`] = firebase.firestore.FieldValue.serverTimestamp();
                updateData[`documentVerification.${documentType}.approvedAt`] = firebase.firestore.FieldValue.delete();
                updateData[`documentVerification.${documentType}.notes`] = 'Document rejected by admin';

                await driverRef.update(updateData);
                
                console.log(`‚úÖ ${documentType} rejected successfully for driver ${driverId}`);
                
                // Show success message
                alert(`‚úÖ ${documentType} rejected successfully!`);
                
                return true;
            } catch (error) {
                console.error(`‚ùå Error rejecting ${documentType}:`, error);
                alert(`‚ùå Error rejecting ${documentType}: ${error.message}`);
                return false;
            }
        };

        function testFunctions() {
            const results = document.getElementById('test-results');
            let html = '<h2>Function Test Results:</h2>';
            
            // Test showSection
            if (typeof window.showSection === 'function') {
                html += '<p>‚úÖ showSection: Available</p>';
                window.showSection('test');
            } else {
                html += '<p>‚ùå showSection: NOT Available</p>';
            }
            
            // Test approveDocument
            if (typeof window.approveDocument === 'function') {
                html += '<p>‚úÖ approveDocument: Available</p>';
            } else {
                html += '<p>‚ùå approveDocument: NOT Available</p>';
            }
            
            // Test rejectDocument
            if (typeof window.rejectDocument === 'function') {
                html += '<p>‚úÖ rejectDocument: Available</p>';
            } else {
                html += '<p>‚ùå rejectDocument: NOT Available</p>';
            }
            
            // Test buttons
            html += '<div style="margin: 20px 0;">';
            html += '<button onclick="window.showSection(\'dashboard\')">Test showSection</button> ';
            html += '<button onclick="window.approveDocument(\'test-driver\', \'driverPhoto\')">Test Approve</button> ';
            html += '<button onclick="window.rejectDocument(\'test-driver\', \'driverPhoto\')">Test Reject</button>';
            html += '</div>';
            
            results.innerHTML = html;
        }

        function loadCompleteAdmin() {
            window.location.href = 'complete-admin.html';
        }

        // Auto-test when page loads
        window.onload = function() {
            console.log('üöÄ Function test page loaded');
            testFunctions();
        };
    </script>
</body>
</html>
